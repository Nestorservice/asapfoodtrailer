<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory ‚Äî ASAP Admin</title>
    <link rel="shortcut icon" href="/assets/img/logo/favicon.svg" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Outfit:wght@600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/admin.css">
    <style>
        .truck-thumb {
            width: 52px;
            height: 40px;
            border-radius: 8px;
            overflow: hidden;
            flex-shrink: 0;
            background: #f8f9fa;
        }

        .truck-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .truck-thumb .empty {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        .status-badge-avail {
            background: #d4edda;
            color: #155724;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: .78rem;
        }

        .status-badge-sold {
            background: #f8d7da;
            color: #721c24;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: .78rem;
        }

        .status-badge-rented {
            background: #fff3cd;
            color: #856404;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: .78rem;
        }

        .status-badge-reserved {
            background: #cce5ff;
            color: #004085;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: .78rem;
        }

        .edit-btn {
            padding: 5px 10px;
            border-radius: 6px;
            font-size: .8rem;
            font-weight: 600;
            border: 1px solid #ff6b00;
            color: #ff6b00;
            background: transparent;
            cursor: pointer;
            transition: all .3s;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .edit-btn:hover {
            background: #ff6b00;
            color: #fff;
        }

        .img-upload-progress {
            height: 4px;
            background: #eee;
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
            display: none;
        }

        .img-upload-progress .bar {
            height: 100%;
            width: 0;
            background: linear-gradient(90deg, #ff6b00, #ff8c33);
            border-radius: 2px;
            transition: width .3s;
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <aside class="admin-sidebar" id="adminSidebar">
        <div class="sidebar-header">
            <img src="/assets/img/logo/logo.jpg" alt="ASAP" class="sidebar-logo" style="height:32px;border-radius:6px;">
            <button class="sidebar-close d-lg-none" onclick="toggleSidebar()"><i class="bi bi-x-lg"></i></button>
        </div>
        <nav class="sidebar-nav">
            <a href="/admin/dashboard" class="nav-item"><i class="bi bi-grid-1x2"></i> Dashboard</a>
            <a href="/admin/inventory" class="nav-item active"><i class="bi bi-truck"></i> Inventory</a>
            <a href="/admin/leads" class="nav-item"><i class="bi bi-person-lines-fill"></i> Leads</a>
            <div class="nav-divider"></div>
            <a href="/" class="nav-item"><i class="bi bi-globe"></i> View Website</a>
            <a href="/admin" class="nav-item" style="color:#ff6b6b;"><i class="bi bi-box-arrow-left"></i> Sign Out</a>
        </nav>
    </aside>
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <!-- Main -->
    <main class="admin-main">
        <div class="admin-topbar">
            <div class="d-flex align-items-center gap-3">
                <button class="topbar-toggle d-lg-none" onclick="toggleSidebar()"><i class="bi bi-list"></i></button>
                <h5 class="mb-0" style="font-family:'Outfit',sans-serif;font-weight:800;">Inventory</h5>
            </div>
            <div class="topbar-right">
                <button class="btn btn-primary"
                    style="background:#ff6b00;border:none;border-radius:10px;font-weight:600;padding:8px 20px;"
                    data-bs-toggle="modal" data-bs-target="#addTruckModal">
                    <i class="bi bi-plus-lg"></i> Add Vehicle
                </button>
            </div>
        </div>

        <div class="admin-content">
            {% if trucks and trucks|length > 0 %}
            <div class="admin-card">
                <div class="admin-card-header">
                    <h6><i class="bi bi-truck"></i> All Vehicles ({{ trucks|length }})</h6>
                </div>
                <div class="admin-card-body p-0">
                    <div class="table-responsive">
                        <table class="table admin-table mb-0">
                            <thead>
                                <tr>
                                    <th>Vehicle</th>
                                    <th>Category</th>
                                    <th>Condition</th>
                                    <th>Price</th>
                                    <th>Status</th>
                                    <th>Views</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for truck in trucks %}
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center gap-2">
                                            <div class="truck-thumb">
                                                {% if truck.images and truck.images|length > 0 %}
                                                <img src="{{ truck.images[0] }}" alt="">
                                                {% else %}
                                                <div class="empty"><i class="bi bi-truck" style="color:#ccc;"></i></div>
                                                {% endif %}
                                            </div>
                                            <strong>{{ truck.title[:30] }}</strong>
                                        </div>
                                    </td>
                                    <td>{{ truck.category | capitalize }}</td>
                                    <td><span
                                            class="badge {{ 'bg-success' if truck.condition=='new' else 'bg-warning text-dark' if truck.condition=='used' else 'bg-info' }}">{{
                                            truck.condition | capitalize }}</span></td>
                                    <td><strong>${{ "{:,.0f}".format(truck.price) }}</strong></td>
                                    <td>
                                        {% if truck.status == 'available' %}
                                        <span class="status-badge-avail"><i class="bi bi-check-circle"></i>
                                            Available</span>
                                        {% elif truck.status == 'sold' %}
                                        <span class="status-badge-sold"><i class="bi bi-x-circle"></i> Sold</span>
                                        {% elif truck.status == 'rented' %}
                                        <span class="status-badge-rented"><i class="bi bi-clock-history"></i>
                                            Rented</span>
                                        {% elif truck.status == 'reserved' %}
                                        <span class="status-badge-reserved"><i class="bi bi-bookmark"></i>
                                            Reserved</span>
                                        {% else %}
                                        <span class="badge bg-secondary">{{ truck.status | capitalize }}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ truck.views | default(0) }}</td>
                                    <td>
                                        <div class="d-flex gap-1">
                                            <button class="edit-btn" onclick='openEdit({{ truck | tojson }})'
                                                title="Edit">
                                                <i class="bi bi-pencil"></i> Edit
                                            </button>
                                            <a href="/{{ truck.category }}/{{ truck.slug }}"
                                                class="btn btn-sm btn-outline-primary" style="border-radius:6px;"
                                                title="View"><i class="bi bi-eye"></i></a>
                                            <button class="btn btn-sm btn-outline-danger" style="border-radius:6px;"
                                                onclick="deleteTruck('{{ truck.id }}')" title="Delete"><i
                                                    class="bi bi-trash"></i></button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="admin-card">
                <div class="admin-card-body">
                    <div class="empty-state">
                        <i class="bi bi-truck"></i>
                        <p>No vehicles in inventory</p>
                        <button class="btn btn-primary mt-2" style="background:#ff6b00;border:none;border-radius:10px;"
                            data-bs-toggle="modal" data-bs-target="#addTruckModal">Add Your First Vehicle</button>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <footer class="admin-footer">
            <p>&copy; 2026 ASAP Food Trailers &mdash; Admin Panel v2.0 &bull; <a href="/">View Website</a></p>
        </footer>
    </main>

    <!-- ‚ïê‚ïê‚ïê ADD TRUCK MODAL ‚ïê‚ïê‚ïê -->
    <div class="modal fade" id="addTruckModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content" style="border:none;border-radius:20px;">
                <div class="modal-header" style="border:none;padding:24px 30px 0;">
                    <h5 class="modal-title" style="font-family:'Outfit',sans-serif;font-weight:800;">Add New Vehicle
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="padding:24px 30px;">
                    <form id="addTruckForm" enctype="multipart/form-data">
                        <div class="row g-3">
                            <div class="col-md-8">
                                <label class="form-label">Title <span class="text-danger">*</span></label>
                                <input type="text" name="title" class="form-control" required
                                    style="border-radius:8px;padding:10px;">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Price ($) <span class="text-danger">*</span></label>
                                <input type="number" name="price" class="form-control" required
                                    style="border-radius:8px;padding:10px;">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Category</label>
                                <select name="category" class="form-select" style="border-radius:8px;padding:10px;">
                                    <option value="truck">Food Truck</option>
                                    <option value="trailer">Food Trailer</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Condition</label>
                                <select name="condition" class="form-select" style="border-radius:8px;padding:10px;">
                                    <option value="new">New</option>
                                    <option value="used">Used</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Usage</label>
                                <select name="usage" class="form-select" style="border-radius:8px;padding:10px;">
                                    <option value="sale">For Sale</option>
                                    <option value="rent">For Rent</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Description <span class="text-danger">*</span></label>
                                <textarea name="description" class="form-control" rows="3" required
                                    style="border-radius:8px;padding:10px;"></textarea>
                            </div>
                            <div class="col-md-3"><label class="form-label">Length</label><input type="text"
                                    name="length" class="form-control" placeholder='e.g. 20ft'
                                    style="border-radius:8px;padding:10px;"></div>
                            <div class="col-md-3"><label class="form-label">Width</label><input type="text" name="width"
                                    class="form-control" placeholder='e.g. 8ft' style="border-radius:8px;padding:10px;">
                            </div>
                            <div class="col-md-3"><label class="form-label">Voltage</label><input type="text"
                                    name="voltage" class="form-control" placeholder='e.g. 120V/240V'
                                    style="border-radius:8px;padding:10px;"></div>
                            <div class="col-md-3"><label class="form-label">Gas</label><input type="text" name="gas"
                                    class="form-control" placeholder='e.g. Propane'
                                    style="border-radius:8px;padding:10px;"></div>
                            <div class="col-12">
                                <label class="form-label">Equipment (comma-separated)</label>
                                <input type="text" name="equipment" class="form-control"
                                    placeholder="Griddle, Fryer, Refrigerator, ..."
                                    style="border-radius:8px;padding:10px;">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Images</label>
                                <input type="file" name="images" class="form-control" multiple accept="image/*"
                                    style="border-radius:8px;padding:10px;">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer" style="border:none;padding:0 30px 24px;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                        style="border-radius:8px;">Cancel</button>
                    <button type="button" class="btn btn-primary" id="submitTruck"
                        style="background:#ff6b00;border:none;border-radius:8px;font-weight:600;padding:10px 24px;">Save
                        Vehicle</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê EDIT TRUCK MODAL ‚ïê‚ïê‚ïê -->
    <div class="modal fade" id="editTruckModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content" style="border:none;border-radius:20px;">
                <div class="modal-header" style="border:none;padding:24px 30px 0;">
                    <h5 class="modal-title" style="font-family:'Outfit',sans-serif;font-weight:800;"><i
                            class="bi bi-pencil-square" style="color:#ff6b00;"></i> Edit Vehicle</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="padding:24px 30px;">
                    <form id="editTruckForm">
                        <input type="hidden" id="editTruckId">
                        <div class="row g-3">
                            <!-- Photos Section -->
                            <div class="col-12">
                                <label class="form-label fw-bold"><i class="bi bi-images" style="color:#ff6b00;"></i>
                                    Vehicle Photos</label>
                                <div class="img-gallery" id="editImgGallery">
                                    <!-- Populated by JS -->
                                </div>
                                <div class="img-upload-zone" id="editImgUploadZone"
                                    onclick="document.getElementById('editImgInput').click()">
                                    <i class="bi bi-cloud-arrow-up"></i>
                                    <span>Click to upload new photos</span>
                                    <div style="font-size:.75rem;color:#bbb;margin-top:4px;">JPG, PNG, WebP ‚Äî Max 5MB
                                        each</div>
                                </div>
                                <input type="file" id="editImgInput" multiple accept="image/*" style="display:none;">
                                <div class="img-upload-progress" id="editImgProgress">
                                    <div class="bar" id="editImgProgressBar"></div>
                                </div>
                            </div>

                            <div class="col-md-8">
                                <label class="form-label fw-bold">Title <span class="text-danger">*</span></label>
                                <input type="text" id="editTitle" class="form-control" required
                                    style="border-radius:8px;padding:10px;">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Price ($) <span class="text-danger">*</span></label>
                                <input type="number" id="editPrice" class="form-control" required
                                    style="border-radius:8px;padding:10px;">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Category</label>
                                <select id="editCategory" class="form-select" style="border-radius:8px;padding:10px;">
                                    <option value="truck">Food Truck</option>
                                    <option value="trailer">Food Trailer</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Condition</label>
                                <select id="editCondition" class="form-select" style="border-radius:8px;padding:10px;">
                                    <option value="new">New</option>
                                    <option value="used">Used</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Usage</label>
                                <select id="editUsage" class="form-select" style="border-radius:8px;padding:10px;">
                                    <option value="sale">For Sale</option>
                                    <option value="rent">For Rent</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold"><i class="bi bi-tag" style="color:#ff6b00;"></i>
                                    Status / Availability</label>
                                <select id="editStatus" class="form-select"
                                    style="border-radius:8px;padding:12px;font-weight:600;font-size:1rem;">
                                    <option value="available">‚úÖ Available</option>
                                    <option value="sold">‚ùå Sold</option>
                                    <option value="rented">‚è≥ Rented</option>
                                    <option value="reserved">üìå Reserved</option>
                                    <option value="maintenance">üîß In Maintenance</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Featured</label>
                                <select id="editFeatured" class="form-select" style="border-radius:8px;padding:12px;">
                                    <option value="false">No</option>
                                    <option value="true">Yes ‚Äî Show on homepage</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label fw-bold">Description</label>
                                <textarea id="editDescription" class="form-control" rows="4"
                                    style="border-radius:8px;padding:10px;"></textarea>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Length</label>
                                <input type="text" id="editLength" class="form-control"
                                    style="border-radius:8px;padding:10px;">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Width</label>
                                <input type="text" id="editWidth" class="form-control"
                                    style="border-radius:8px;padding:10px;">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Voltage</label>
                                <input type="text" id="editVoltage" class="form-control"
                                    style="border-radius:8px;padding:10px;">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Gas</label>
                                <input type="text" id="editGas" class="form-control"
                                    style="border-radius:8px;padding:10px;">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Equipment (comma-separated)</label>
                                <input type="text" id="editEquipment" class="form-control"
                                    style="border-radius:8px;padding:10px;">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer" style="border:none;padding:0 30px 24px;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                        style="border-radius:8px;">Cancel</button>
                    <button type="button" class="btn btn-primary" id="submitEdit"
                        style="background:#ff6b00;border:none;border-radius:8px;font-weight:600;padding:10px 24px;">
                        <i class="bi bi-check-lg"></i> Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="asap-toast" id="asapToast"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ‚îÄ‚îÄ Globals ‚îÄ‚îÄ
        var currentEditImages = [];
        var currentEditTruckId = '';

        function toggleSidebar() {
            document.getElementById('adminSidebar').classList.toggle('open');
            document.getElementById('sidebarOverlay').classList.toggle('show');
        }

        function showToast(msg, type) {
            var t = document.getElementById('asapToast');
            t.textContent = msg;
            t.className = 'asap-toast show ' + (type || '');
            setTimeout(function () { t.className = 'asap-toast'; }, 3500);
        }

        // ‚îÄ‚îÄ Render image gallery ‚îÄ‚îÄ
        function renderImageGallery() {
            var gallery = document.getElementById('editImgGallery');
            if (!currentEditImages || currentEditImages.length === 0) {
                gallery.innerHTML = '<div style="color:#bbb;font-size:.85rem;padding:8px 0;"><i class="bi bi-image"></i> No photos yet ‚Äî upload some below</div>';
                return;
            }
            gallery.innerHTML = currentEditImages.map(function (url, i) {
                return '<div class="img-gallery-item">' +
                    '<img src="' + url + '" alt="Photo ' + (i + 1) + '">' +
                    '<button type="button" class="img-remove" onclick="removeImage(' + i + ')" title="Remove photo">' +
                    '<i class="bi bi-x"></i></button>' +
                    '</div>';
            }).join('');
        }

        // ‚îÄ‚îÄ Remove image ‚îÄ‚îÄ
        function removeImage(index) {
            var url = currentEditImages[index];
            if (!confirm('Remove this photo?')) return;

            fetch('/api/trucks/' + currentEditTruckId + '/images', {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ image_url: url })
            })
                .then(function (r) { return r.json(); })
                .then(function (data) {
                    if (data.success) {
                        currentEditImages.splice(index, 1);
                        renderImageGallery();
                        showToast('Photo removed', 'success');
                    } else {
                        showToast('Error removing photo', 'error');
                    }
                })
                .catch(function () { showToast('Connection error', 'error'); });
        }

        // ‚îÄ‚îÄ Upload new images ‚îÄ‚îÄ
        document.getElementById('editImgInput').addEventListener('change', async function () {
            var files = this.files;
            if (!files.length) return;

            var progressDiv = document.getElementById('editImgProgress');
            var progressBar = document.getElementById('editImgProgressBar');
            progressDiv.style.display = 'block';
            progressBar.style.width = '10%';

            var fd = new FormData();
            for (var i = 0; i < files.length; i++) {
                fd.append('images', files[i]);
            }

            try {
                progressBar.style.width = '50%';
                var res = await fetch('/api/trucks/' + currentEditTruckId + '/images', {
                    method: 'POST',
                    body: fd
                });
                progressBar.style.width = '90%';
                var data = await res.json();
                if (data.success) {
                    currentEditImages = data.images || currentEditImages;
                    renderImageGallery();
                    showToast(files.length + ' photo(s) uploaded!', 'success');
                } else {
                    showToast('Error: ' + (data.detail || 'Upload failed'), 'error');
                }
            } catch (e) {
                showToast('Upload failed', 'error');
            }

            progressBar.style.width = '100%';
            setTimeout(function () {
                progressDiv.style.display = 'none';
                progressBar.style.width = '0';
            }, 500);
            this.value = '';
        });

        // ‚îÄ‚îÄ ADD VEHICLE ‚îÄ‚îÄ
        document.getElementById('submitTruck').addEventListener('click', async function () {
            var form = document.getElementById('addTruckForm');
            var fd = new FormData(form);
            this.disabled = true;
            this.textContent = 'Saving...';
            try {
                var res = await fetch('/api/trucks', { method: 'POST', body: fd });
                var data = await res.json();
                if (data.success) {
                    showToast('Vehicle added successfully!', 'success');
                    setTimeout(function () { window.location.reload(); }, 1000);
                } else {
                    showToast('Error: ' + (data.detail || 'Failed to save'), 'error');
                }
            } catch (e) {
                showToast('Connection error', 'error');
            }
            this.disabled = false;
            this.textContent = 'Save Vehicle';
        });

        // ‚îÄ‚îÄ EDIT VEHICLE ‚Äî open modal ‚îÄ‚îÄ
        function openEdit(truck) {
            currentEditTruckId = truck.id;
            currentEditImages = (truck.images || []).slice();

            document.getElementById('editTruckId').value = truck.id;
            document.getElementById('editTitle').value = truck.title || '';
            document.getElementById('editPrice').value = truck.price || '';
            document.getElementById('editCategory').value = truck.category || 'truck';
            document.getElementById('editCondition').value = truck.condition || 'new';
            document.getElementById('editUsage').value = truck.usage || 'sale';
            document.getElementById('editStatus').value = truck.status || 'available';
            document.getElementById('editFeatured').value = truck.featured ? 'true' : 'false';
            document.getElementById('editDescription').value = truck.description || '';

            var specs = truck.specs || {};
            document.getElementById('editLength').value = specs.length || '';
            document.getElementById('editWidth').value = specs.width || '';
            document.getElementById('editVoltage').value = specs.voltage || '';
            document.getElementById('editGas').value = specs.gas || '';

            var eq = truck.equipment || [];
            document.getElementById('editEquipment').value = Array.isArray(eq) ? eq.join(', ') : eq;

            renderImageGallery();

            var modal = new bootstrap.Modal(document.getElementById('editTruckModal'));
            modal.show();
        }

        // ‚îÄ‚îÄ EDIT VEHICLE ‚Äî save ‚îÄ‚îÄ
        document.getElementById('submitEdit').addEventListener('click', async function () {
            var truckId = document.getElementById('editTruckId').value;
            var payload = {
                title: document.getElementById('editTitle').value,
                price: parseFloat(document.getElementById('editPrice').value) || 0,
                category: document.getElementById('editCategory').value,
                condition: document.getElementById('editCondition').value,
                usage: document.getElementById('editUsage').value,
                status: document.getElementById('editStatus').value,
                featured: document.getElementById('editFeatured').value === 'true',
                description: document.getElementById('editDescription').value,
                specs: {
                    length: document.getElementById('editLength').value,
                    width: document.getElementById('editWidth').value,
                    voltage: document.getElementById('editVoltage').value,
                    gas: document.getElementById('editGas').value
                },
                equipment: document.getElementById('editEquipment').value.split(',').map(function (s) { return s.trim(); }).filter(Boolean),
                images: currentEditImages
            };

            this.disabled = true;
            this.innerHTML = '<i class="bi bi-hourglass-split"></i> Saving...';
            try {
                var res = await fetch('/api/trucks/' + truckId, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                var data = await res.json();
                if (data.success) {
                    showToast('Vehicle updated successfully!', 'success');
                    setTimeout(function () { window.location.reload(); }, 1000);
                } else {
                    showToast('Error: ' + (data.detail || 'Failed to update'), 'error');
                }
            } catch (e) {
                showToast('Connection error', 'error');
            }
            this.disabled = false;
            this.innerHTML = '<i class="bi bi-check-lg"></i> Save Changes';
        });

        // ‚îÄ‚îÄ DELETE VEHICLE ‚îÄ‚îÄ
        function deleteTruck(id) {
            if (!confirm('Delete this vehicle? This cannot be undone.')) return;
            fetch('/api/trucks/' + id, { method: 'DELETE' })
                .then(function (r) { return r.json(); })
                .then(function (data) {
                    if (data.success) {
                        showToast('Vehicle deleted', 'success');
                        setTimeout(function () { window.location.reload(); }, 800);
                    } else {
                        showToast('Error deleting vehicle', 'error');
                    }
                });
        }
    </script>
</body>

</html>